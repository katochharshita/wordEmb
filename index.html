<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Embeddings Explorer</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc;
            touch-action: pan-y;
        }
        .grid-bg {
            background-image: linear-gradient(#e2e8f0 1px, transparent 1px),
            linear-gradient(90deg, #e2e8f0 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .no-select {
            user-select: none;
            -webkit-user-select: none;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Localization ---
        const TRANSLATIONS = {
            en: {
                title: "AI Word Embeddings",
                step: "Step",
                next: "Next",
                back: "Back",
                introTitle: "How do computers \"read\"?",
                introText: "Computers don't understand words. They understand Numbers. To teach an AI, we turn every word into a list of numbers called a Vector.",
                introBtn: "Let's Create Vectors!",
                gridTitle: "Build the Embedding Space",
                gridDesc: "Drag the food items to define them. Watch how moving the item changes its Vector Numbers.",
                looksGood: "Looks Good! Next ‚Üí",
                dragStart: "Drag items to Start",
                matrixTitle: "The \"Matrix\" View",
                matrixDesc: "This is how the AI actually sees your map. It's just a table of coordinates called an Embedding Matrix.",
                transform: "Transform to Math Matrix",
                showTable: "Show Table View",
                analyzeBtn: "Analyze Similarities",
                simTitle: "Cosine Similarity Lab",
                simDesc: "Select two items to see how AI compares them using math.",
                calcTitle: "Calculation Result",
                formulaLabel: "The Formula",
                angleLabel: "Angle",
                conclusionTitle: "You've mastered Embeddings!",
                c1: "Computers read words as Vectors (lists of numbers).",
                c2: "Similar words are placed closer together.",
                c3: "AI calculates Cosine Similarity (the angle) to find meaning.",
                restart: "Restart Application",
                axes: { crunchy: "CRUNCHY", soft: "SOFT", savory: "SAVORY", sweet: "SWEET" },
                table: { item: "Item", sweet: "Sweetness", crunchy: "Crunchiness", mag: "Magnitude" },
                similarity: { high: "Very Similar", mid: "Related", low: "Different", opp: "Opposite" }
            },
            de: {
                title: "KI-Worteinbettungen",
                step: "Schritt",
                next: "Weiter",
                back: "Zur√ºck",
                introTitle: "Wie \"lesen\" Computer?",
                introText: "Computer verstehen keine W√∂rter. Sie verstehen Zahlen. Wir verwandeln jedes Wort in eine Zahlenliste, einen Vektor.",
                introBtn: "Vektoren erstellen!",
                gridTitle: "Den Einbettungsraum bauen",
                gridDesc: "Ziehe die Nahrungsmittel, um sie zu definieren. Beobachte, wie sich die Vektor-Zahlen √§ndern.",
                looksGood: "Weiter ‚Üí",
                dragStart: "Zum Starten ziehen",
                matrixTitle: "Die \"Matrix\"-Ansicht",
                matrixDesc: "So sieht die KI deine Karte. Es ist eine Koordinatentabelle, die Einbettungsmatrix.",
                transform: "In Matrix umwandeln",
                showTable: "Tabelle anzeigen",
                analyzeBtn: "√Ñhnlichkeiten analysieren",
                simTitle: "Kosinus-√Ñhnlichkeit Labor",
                simDesc: "W√§hle zwei Elemente, um zu sehen, wie die KI sie mathematisch vergleicht.",
                calcTitle: "Berechnungsergebnis",
                formulaLabel: "Die Formel",
                angleLabel: "Winkel",
                conclusionTitle: "Du hast Embeddings gemeistert!",
                c1: "Computer lesen W√∂rter als Vektoren (Zahlenlisten).",
                c2: "√Ñhnliche W√∂rter liegen n√§her beieinander.",
                c3: "KI berechnet die Kosinus-√Ñhnlichkeit (den Winkel).",
                restart: "Neustart",
                axes: { crunchy: "KNUSPRIG", soft: "WEICH", savory: "HERZHAFT", sweet: "S√úSS" },
                table: { item: "Objekt", sweet: "S√º√üe", crunchy: "Knusprigkeit", mag: "Gr√∂√üe" },
                similarity: { high: "Sehr √§hnlich", mid: "Verwandt", low: "Unterschiedlich", opp: "Gegenteil" }
            },
            es: {
                title: "Incrustaciones de Palabras IA",
                step: "Paso",
                next: "Siguiente",
                back: "Atr√°s",
                introTitle: "¬øC√≥mo \"leen\" las computadoras?",
                introText: "Las computadoras entienden n√∫meros, no palabras. Convertimos cada palabra en una lista de n√∫meros llamada Vector.",
                introBtn: "¬°Crear Vectores!",
                gridTitle: "Construir Espacio de Incrustaci√≥n",
                gridDesc: "Arrastra los alimentos para definirlos. Mira c√≥mo cambian los n√∫meros del vector.",
                looksGood: "Continuar ‚Üí",
                dragStart: "Arrastra para empezar",
                matrixTitle: "Vista de \"Matriz\"",
                matrixDesc: "As√≠ ve la IA tu mapa. Es una tabla de coordenadas llamada Matriz de Incrustaci√≥n.",
                transform: "Transformar a Matriz",
                showTable: "Mostrar Tabla",
                analyzeBtn: "Analizar Similitudes",
                simTitle: "Laboratorio de Similitud Coseno",
                simDesc: "Selecciona dos elementos para ver c√≥mo la IA los compara matem√°ticamente.",
                calcTitle: "Resultado del C√°lculo",
                formulaLabel: "La F√≥rmula",
                angleLabel: "√Ångulo",
                conclusionTitle: "¬°Has dominado las Incrustaciones!",
                c1: "Las computadoras leen palabras como Vectores.",
                c2: "Las palabras similares est√°n m√°s cerca.",
                c3: "La IA calcula la Similitud del Coseno (el √°ngulo).",
                restart: "Reiniciar",
                axes: { crunchy: "CRUJIENTE", soft: "SUAVE", savory: "SALADO", sweet: "DULCE" },
                table: { item: "√çtem", sweet: "Dulzura", crunchy: "Crujido", mag: "Magnitud" },
                similarity: { high: "Muy Similar", mid: "Relacionado", low: "Diferente", opp: "Opuesto" }
            },
            pt: {
                title: "Word Embeddings com IA",
                step: "Passo",
                next: "Pr√≥ximo",
                back: "Voltar",
                introTitle: "Como computadores \"leem\"?",
                introText: "Computadores entendem n√∫meros. Transformamos cada palavra em uma lista de n√∫meros chamada Vetor.",
                introBtn: "Criar Vetores!",
                gridTitle: "Construir Espa√ßo de Embedding",
                gridDesc: "Arraste os alimentos para defini-los. Veja como os n√∫meros do vetor mudam.",
                looksGood: "Continuar ‚Üí",
                dragStart: "Arraste para come√ßar",
                matrixTitle: "Vis√£o de \"Matriz\"",
                matrixDesc: "√â assim que a IA v√™ seu mapa. √â uma tabela de coordenadas chamada Matriz de Embedding.",
                transform: "Transformar em Matriz",
                showTable: "Mostrar Tabela",
                analyzeBtn: "Analisar Similaridades",
                simTitle: "Lab de Similaridade de Cosseno",
                simDesc: "Selecione dois itens para ver como a IA os compara matematicamente.",
                calcTitle: "Resultado do C√°lculo",
                formulaLabel: "A F√≥rmula",
                angleLabel: "√Çngulo",
                conclusionTitle: "Voc√™ dominou Embeddings!",
                c1: "Computadores leem palavras como Vetores.",
                c2: "Palavras similares ficam mais pr√≥ximas.",
                c3: "IA calcula a Similaridade de Cosseno (o √¢ngulo).",
                restart: "Reiniciar",
                axes: { crunchy: "CROCANTE", soft: "MACIO", savory: "SALGADO", sweet: "DOCE" },
                table: { item: "Item", sweet: "Do√ßura", crunchy: "Croc√¢ncia", mag: "Magnitude" },
                similarity: { high: "Muito Similar", mid: "Relacionado", low: "Diferente", opp: "Oposto" }
            }
        };

        const FOOD_NAMES = {
            1: { en: 'Apple', de: 'Apfel', es: 'Manzana', pt: 'Ma√ß√£' },
            2: { en: 'Cookie', de: 'Keks', es: 'Galleta', pt: 'Biscoito' },
            3: { en: 'Pretzel', de: 'Brezel', es: 'Pretzel', pt: 'Pretzel' },
            4: { en: 'Steak', de: 'Steak', es: 'Filete', pt: 'Bife' },
            5: { en: 'Donut', de: 'Donut', es: 'Rosquilla', pt: 'Donut' },
            6: { en: 'Carrot', de: 'Karotte', es: 'Zanahoria', pt: 'Cenoura' },
            7: { en: 'Soup', de: 'Suppe', es: 'Sopa', pt: 'Sopa' },
            8: { en: 'Popcorn', de: 'Popcorn', es: 'Palomitas', pt: 'Pipoca' }
        };

        // --- Data ---
        const INITIAL_FOODS = [
            { id: 1, emoji: 'üçé', x: 0.1, y: 0.1, category: 'fruit' },
            { id: 2, emoji: 'üç™', x: -0.1, y: 0.1, category: 'snack' },
            { id: 3, emoji: 'ü•®', x: 0.1, y: -0.1, category: 'snack' }, 
            { id: 4, emoji: 'ü•©', x: -0.1, y: -0.1, category: 'meal' },
            { id: 5, emoji: 'üç©', x: 0.05, y: 0.2, category: 'snack' },
            { id: 6, emoji: 'ü•ï', x: -0.05, y: 0.2, category: 'veg' },
            { id: 7, emoji: 'üç≤', x: -0.2, y: -0.05, category: 'meal' },
            { id: 8, emoji: 'üçø', x: 0.2, y: 0.2, category: 'snack' }
        ];

        // --- Helper Functions ---
        const mapRange = (value, inMin, inMax, outMin, outMax) => {
            return (value - inMin) * (outMax - outMin) / (inMax - inMin) + outMin;
        };

        const calculateCosineSimilarity = (v1, v2) => {
            const dotProduct = (v1.x * v2.x) + (v1.y * v2.y);
            const mag1 = Math.sqrt(v1.x ** 2 + v1.y ** 2);
            const mag2 = Math.sqrt(v2.x ** 2 + v2.y ** 2);
            if (mag1 === 0 || mag2 === 0) return 0;
            return dotProduct / (mag1 * mag2);
        };

        const getSimilarityColor = (score) => {
            if (score > 0.8) return 'text-green-600';
            if (score > 0.4) return 'text-green-500';
            if (score > 0) return 'text-yellow-600';
            return 'text-red-500';
        };

        const getFoodName = (id, lang) => {
            return FOOD_NAMES[id][lang] || FOOD_NAMES[id]['en'];
        };

        const FoodVisual = ({ food, className = "" }) => {
            return <span className={className}>{food.emoji}</span>;
        };

        // --- Component: Header ---
        const Header = ({ step, lang, setLang, t, onBack }) => (
            <div className="w-full bg-slate-800 text-white p-4 shadow-md flex justify-between items-center sticky top-0 z-50">
                <div className="flex items-center gap-4">
                    {step > 1 && (
                        <button 
                            onClick={onBack}
                            className="bg-slate-700 hover:bg-slate-600 p-2 rounded-full transition-colors flex items-center gap-1 text-sm font-semibold px-3"
                        >
                            <i data-lucide="arrow-left" className="w-4 h-4"></i> {t.back}
                        </button>
                    )}
                    <h1 className="text-xl font-bold flex items-center gap-2 hidden md:flex">
                        <span>üß†</span> {t.title}
                    </h1>
                </div>
                
                <div className="flex items-center gap-4">
                    <div className="flex bg-slate-700 rounded-lg p-1">
                        {['en', 'de', 'es', 'pt'].map(l => (
                            <button
                                key={l}
                                onClick={() => setLang(l)}
                                className={`px-2 py-1 rounded text-xs font-bold uppercase transition-all ${lang === l ? 'bg-indigo-500 text-white shadow' : 'text-slate-400 hover:text-white'}`}
                            >
                                {l}
                            </button>
                        ))}
                    </div>
                    <div className="text-sm bg-slate-700 px-3 py-1 rounded-full whitespace-nowrap">
                        {t.step} {step} / 5
                    </div>
                </div>
            </div>
        );

        // --- Component: Step 1 (Intro) ---
        const StepIntro = ({ onNext, t }) => (
            <div className="flex flex-col items-center justify-center min-h-[calc(100vh-80px)] p-6 text-center fade-in">
                <div className="bg-white p-8 rounded-2xl shadow-xl max-w-2xl w-full">
                    <h2 className="text-3xl font-bold text-slate-800 mb-6">{t.introTitle}</h2>
                    
                    <div className="flex flex-col md:flex-row items-center justify-center gap-8 mb-8">
                        <div className="text-center">
                            <div className="text-6xl mb-2">üçé</div>
                        </div>
                        
                        <div className="text-3xl text-slate-400">‚Üí</div>
                        
                        <div className="bg-slate-900 text-green-400 font-mono p-4 rounded-lg shadow-inner text-left">
                            <p className="mb-1 opacity-50">// Vector</p>
                            <p>[</p>
                            <p className="pl-4">0.892, <span className="text-slate-500">// {t.table.sweet}</span></p>
                            <p className="pl-4">0.910, <span className="text-slate-500">// {t.table.crunchy}</span></p>
                            <p>]</p>
                        </div>
                    </div>

                    <p className="text-lg text-slate-600 mb-8 leading-relaxed">
                        {t.introText}
                    </p>

                    <button 
                        onClick={onNext}
                        className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full transition-all transform hover:scale-105 shadow-lg"
                    >
                        {t.introBtn} ‚Üí
                    </button>
                </div>
            </div>
        );

        // --- Component: Step 2 (The Grid) ---
        const StepGrid = ({ foods, setFoods, onNext, t, lang }) => {
            const containerRef = useRef(null);
            const [dragId, setDragId] = useState(null);
            const [hasMoved, setHasMoved] = useState(false);

            // Handle Mouse/Touch interaction
            const handleMove = (clientX, clientY) => {
                if (dragId === null || !containerRef.current) return;
                
                const rect = containerRef.current.getBoundingClientRect();
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                
                let x = (clientX - rect.left - centerX) / (rect.width / 2);
                let y = (centerY - (clientY - rect.top)) / (rect.height / 2); 

                x = Math.max(-1, Math.min(1, x));
                y = Math.max(-1, Math.min(1, y));

                setFoods(prev => prev.map(f => f.id === dragId ? { ...f, x, y } : f));
                setHasMoved(true);
            };

            const onMouseMove = (e) => handleMove(e.clientX, e.clientY);
            const onTouchMove = (e) => handleMove(e.touches[0].clientX, e.touches[0].clientY);
            const endDrag = () => setDragId(null);

            return (
                <div className="flex flex-col items-center min-h-[calc(100vh-80px)] p-4 fade-in pb-20" 
                     onMouseMove={onMouseMove} onMouseUp={endDrag} onMouseLeave={endDrag}
                     onTouchMove={onTouchMove} onTouchEnd={endDrag}
                >
                    <div className="text-center mb-4 max-w-3xl">
                        <h2 className="text-2xl font-bold text-slate-800">{t.gridTitle}</h2>
                        <p className="text-slate-600 text-sm md:text-base">
                            {t.gridDesc}
                        </p>
                    </div>

                    <div className="flex flex-col lg:flex-row gap-8 items-start justify-center w-full max-w-6xl">
                        
                        {/* LEFT: The Graph */}
                        <div className="relative w-full max-w-[500px] aspect-square bg-white rounded-xl shadow-lg border-2 border-slate-200 grid-bg overflow-hidden no-select flex-shrink-0 mx-auto"
                             ref={containerRef}>
                            
                            {/* Axes Labels */}
                            <div className="absolute top-2 left-1/2 -translate-x-1/2 font-bold text-indigo-600 bg-white/80 px-2 rounded pointer-events-none z-0">{t.axes.crunchy} (+1)</div>
                            <div className="absolute bottom-2 left-1/2 -translate-x-1/2 font-bold text-orange-600 bg-white/80 px-2 rounded pointer-events-none z-0">{t.axes.soft} (-1)</div>
                            <div className="absolute left-2 top-1/2 -translate-y-1/2 -rotate-90 font-bold text-amber-700 bg-white/80 px-2 rounded origin-center pointer-events-none z-0">{t.axes.savory} (-1)</div>
                            <div className="absolute right-2 top-1/2 -translate-y-1/2 rotate-90 font-bold text-pink-600 bg-white/80 px-2 rounded origin-center pointer-events-none z-0">{t.axes.sweet} (+1)</div>

                            {/* Crosshairs */}
                            <div className="absolute top-0 bottom-0 left-1/2 w-0.5 bg-slate-300 pointer-events-none z-0"></div>
                            <div className="absolute left-0 right-0 top-1/2 h-0.5 bg-slate-300 pointer-events-none z-0"></div>

                            {/* Vectors & Items */}
                            {foods.map(food => {
                                const left = `${(food.x + 1) * 50}%`;
                                const top = `${(1 - food.y) * 50}%`;

                                return (
                                    <div key={food.id}>
                                        <svg className="absolute top-0 left-0 w-full h-full pointer-events-none opacity-40 z-0">
                                            <line 
                                                x1="50%" y1="50%" 
                                                x2={left} y2={top} 
                                                stroke={food.id === dragId ? "#4f46e5" : "#94a3b8"} 
                                                strokeWidth="3" 
                                            />
                                        </svg>
                                        
                                        <div 
                                            className={`absolute w-14 h-14 -ml-7 -mt-7 flex items-center justify-center text-4xl cursor-grab active:cursor-grabbing hover:scale-110 transition-transform
                                                ${food.id === dragId ? 'z-50 scale-125 drop-shadow-2xl' : 'z-10'}
                                            `}
                                            style={{ left, top }}
                                            onMouseDown={() => setDragId(food.id)}
                                            onTouchStart={() => setDragId(food.id)}
                                        >
                                            <FoodVisual food={food} className="select-none w-full h-full flex items-center justify-center" />
                                            
                                            {food.id === dragId && (
                                                <div className="absolute -top-14 bg-slate-900 text-white px-3 py-2 rounded-lg shadow-xl whitespace-nowrap z-50 pointer-events-none border border-slate-700">
                                                    <div className="font-bold text-center text-sm border-b border-slate-700 pb-1 mb-1">{getFoodName(food.id, lang)}</div>
                                                    <div className="font-mono text-xs text-indigo-300 flex gap-2">
                                                        <span>x: {food.x.toFixed(2)}</span>
                                                        <span>y: {food.y.toFixed(2)}</span>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {/* RIGHT: The Live Table */}
                        <div className="w-full max-w-md bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden flex-shrink-0 mx-auto">
                            <div className="bg-slate-50 border-b border-slate-200 p-3 font-bold text-slate-700 text-center flex justify-between items-center">
                                <span>{t.matrixTitle}</span>
                                <span className="text-xs font-normal text-slate-500 bg-white px-2 py-1 rounded border">Live</span>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm text-left text-slate-600">
                                    <thead className="text-xs text-slate-500 uppercase bg-slate-100/50">
                                        <tr>
                                            <th className="px-4 py-2">{t.table.item}</th>
                                            <th className="px-4 py-2 text-center text-pink-600">{t.table.sweet}</th>
                                            <th className="px-4 py-2 text-center text-indigo-600">{t.table.crunchy}</th>
                                            <th className="px-4 py-2 text-center text-slate-600">{t.table.mag}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {foods.map(f => {
                                            const magnitude = Math.sqrt(f.x * f.x + f.y * f.y);
                                            return (
                                                <tr key={f.id} className={`border-b last:border-0 transition-colors duration-100 ${f.id === dragId ? 'bg-indigo-50' : 'hover:bg-slate-50'}`}>
                                                    <td className="px-4 py-3 font-medium text-slate-900 flex items-center gap-2">
                                                        <div className="w-6 h-6 flex items-center justify-center text-lg">
                                                            <FoodVisual food={f} />
                                                        </div>
                                                        {getFoodName(f.id, lang)}
                                                    </td>
                                                    <td className="px-4 py-3 font-mono text-center">
                                                        <span className={`px-2 py-1 rounded ${f.id === dragId ? 'bg-white font-bold' : ''}`}>
                                                            {f.x.toFixed(2)}
                                                        </span>
                                                    </td>
                                                    <td className="px-4 py-3 font-mono text-center">
                                                        <span className={`px-2 py-1 rounded ${f.id === dragId ? 'bg-white font-bold' : ''}`}>
                                                            {f.y.toFixed(2)}
                                                        </span>
                                                    </td>
                                                    <td className="px-4 py-3 font-mono text-center text-slate-500">
                                                        {magnitude.toFixed(2)}
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>

                    <div className="mt-8 mb-4">
                         <button 
                            onClick={onNext}
                            disabled={!hasMoved}
                            className={`font-bold py-3 px-10 rounded-full shadow-lg transition-all transform hover:scale-105 ${hasMoved ? 'bg-indigo-600 text-white hover:bg-indigo-700' : 'bg-slate-300 text-slate-500 cursor-not-allowed'}`}
                        >
                            {hasMoved ? t.looksGood : t.dragStart}
                        </button>
                    </div>
                </div>
            );
        };

        // --- Component: Step 3 (The Matrix) ---
        const StepMatrix = ({ foods, onNext, t, lang }) => {
            const [isMath, setIsMath] = useState(false);

            return (
                <div className="flex flex-col items-center min-h-[calc(100vh-80px)] p-6 text-center fade-in pb-20">
                    <div className="max-w-4xl w-full">
                        <h2 className="text-3xl font-bold text-slate-800 mb-2">{t.matrixTitle}</h2>
                        <p className="text-slate-600 mb-6">{t.matrixDesc}</p>

                        {/* Grid Stack Layout */}
                        <div className="grid grid-cols-1 grid-rows-1 w-full transition-all duration-500 mb-8">
                            
                            {/* TABLE VIEW */}
                            <div 
                                className={`col-start-1 row-start-1 w-full transition-all duration-700 transform ${isMath ? 'opacity-0 scale-95 pointer-events-none invisible' : 'opacity-100 scale-100 visible'}`}
                            >
                                <div className="bg-white rounded-xl shadow-xl overflow-hidden border border-slate-200">
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm text-left text-slate-500">
                                            <thead className="text-xs text-slate-700 uppercase bg-slate-100">
                                                <tr>
                                                    <th scope="col" className="px-6 py-3">{t.table.item}</th>
                                                    <th scope="col" className="px-6 py-3">{t.table.sweet}</th>
                                                    <th scope="col" className="px-6 py-3">{t.table.crunchy}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {foods.map((food) => (
                                                    <tr key={food.id} className="bg-white border-b hover:bg-slate-50">
                                                        <td className="px-6 py-4 font-medium text-slate-900 whitespace-nowrap flex items-center">
                                                            <div className="w-6 h-6 mr-2 flex items-center justify-center text-xl">
                                                                <FoodVisual food={food} />
                                                            </div>
                                                            {getFoodName(food.id, lang)}
                                                        </td>
                                                        <td className="px-6 py-4 font-mono">
                                                            <div className="flex items-center gap-2">
                                                                <div className={`h-2 rounded-full ${food.x > 0 ? 'bg-pink-500' : 'bg-amber-600'}`} style={{width: `${Math.abs(food.x)*40}px`}}></div>
                                                                {food.x.toFixed(3)}
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 font-mono">
                                                            <div className="flex items-center gap-2">
                                                                <div className={`h-2 rounded-full ${food.y > 0 ? 'bg-indigo-500' : 'bg-orange-500'}`} style={{width: `${Math.abs(food.y)*40}px`}}></div>
                                                                {food.y.toFixed(3)}
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            {/* MATH MATRIX VIEW */}
                            <div className={`col-start-1 row-start-1 w-full flex items-center justify-center transition-all duration-700 transform ${!isMath ? 'opacity-0 scale-110 pointer-events-none' : 'opacity-100 scale-100'}`}>
                                <div className="flex items-center gap-6 bg-white p-8 rounded-xl shadow-xl border border-slate-100">
                                    
                                    {/* Labels */}
                                    <div className="flex flex-col gap-3 text-right font-bold text-slate-600 text-sm">
                                        {foods.map(f => (
                                            <div key={f.id} className="h-8 flex items-center justify-end gap-2">
                                                {getFoodName(f.id, lang)} <span className="text-xl"><FoodVisual food={f} /></span>
                                            </div>
                                        ))}
                                    </div>

                                    {/* The Matrix */}
                                    <div className="relative px-6 py-2">
                                        {/* Brackets */}
                                        <div className="absolute top-0 bottom-0 left-0 w-6 border-l-4 border-t-4 border-b-4 border-slate-800 rounded-l-xl"></div>
                                        <div className="absolute top-0 bottom-0 right-0 w-6 border-r-4 border-t-4 border-b-4 border-slate-800 rounded-r-xl"></div>
                                        
                                        {/* Numbers */}
                                        <div className="grid grid-cols-2 gap-x-8 gap-y-3 font-mono text-lg text-slate-800">
                                            {foods.map(f => (
                                                <React.Fragment key={f.id}>
                                                    <div className="h-8 flex items-center justify-end w-24">
                                                        {f.x.toFixed(3)}
                                                    </div>
                                                    <div className="h-8 flex items-center justify-end w-24">
                                                        {f.y.toFixed(3)}
                                                    </div>
                                                </React.Fragment>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div className="flex justify-center gap-4 mt-8 pb-10">
                             <button 
                                onClick={() => setIsMath(!isMath)}
                                className="bg-white border-2 border-indigo-600 text-indigo-600 hover:bg-indigo-50 font-bold py-3 px-8 rounded-full shadow-lg transition-all"
                            >
                                {isMath ? t.showTable : t.transform}
                            </button>

                            <button 
                                onClick={onNext}
                                className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all"
                            >
                                {t.analyzeBtn} ‚Üí
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Component: Step 4 (Similarity) ---
        const StepSimilarity = ({ foods, onNext, t, lang }) => {
            const [item1Id, setItem1Id] = useState(foods[0].id);
            const [item2Id, setItem2Id] = useState(foods[1].id);

            const item1 = foods.find(f => f.id == item1Id);
            const item2 = foods.find(f => f.id == item2Id);

            // Calculations
            const dotProduct = (item1.x * item2.x) + (item1.y * item2.y);
            const mag1 = Math.sqrt(item1.x ** 2 + item1.y ** 2);
            const mag2 = Math.sqrt(item2.x ** 2 + item2.y ** 2);
            const denominator = mag1 * mag2;
            const similarity = denominator !== 0 ? dotProduct / denominator : 0;
            
            const angleRad = Math.acos(Math.min(1, Math.max(-1, similarity)));
            const angleDeg = angleRad * (180 / Math.PI);

            // SVG Helper for Arc
            let startAngle = Math.atan2(-item1.y, item1.x);
            let endAngle = Math.atan2(-item2.y, item2.x);
            let diff = endAngle - startAngle;
            if (diff > Math.PI) endAngle -= 2 * Math.PI;
            if (diff < -Math.PI) endAngle += 2 * Math.PI;
            
            const radius = 0.3; 
            const startX = Math.cos(startAngle) * radius;
            const startY = Math.sin(startAngle) * radius;
            const endX = Math.cos(endAngle) * radius;
            const endY = Math.sin(endAngle) * radius;
            
            const largeArc = Math.abs(endAngle - startAngle) > Math.PI ? 1 : 0;
            const sweep = endAngle > startAngle ? 1 : 0;
            
            const arcPath = `M ${startX} ${startY} A ${radius} ${radius} 0 ${largeArc} ${sweep} ${endX} ${endY}`;

            return (
                <div className="flex flex-col items-center min-h-[calc(100vh-80px)] p-4 fade-in pb-20">
                    <div className="text-center mb-6 max-w-2xl">
                        <h2 className="text-2xl font-bold text-slate-800">{t.simTitle}</h2>
                        <p className="text-slate-600 text-sm">
                            {t.simDesc}
                        </p>
                    </div>

                    {/* Selectors */}
                    <div className="flex flex-wrap justify-center gap-4 mb-6 w-full max-w-xl bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                        <div className="flex items-center gap-2">
                            <div className="w-3 h-3 rounded-full bg-blue-500"></div>
                            <select 
                                value={item1Id} 
                                onChange={(e) => setItem1Id(Number(e.target.value))}
                                className="p-2 border rounded-lg bg-slate-50 font-bold text-slate-700"
                            >
                                {foods.map(f => <option key={f.id} value={f.id}>{f.emoji} {getFoodName(f.id, lang)}</option>)}
                            </select>
                        </div>
                        <span className="text-slate-400 font-bold self-center">VS</span>
                        <div className="flex items-center gap-2">
                            <div className="w-3 h-3 rounded-full bg-red-500"></div>
                            <select 
                                value={item2Id} 
                                onChange={(e) => setItem2Id(Number(e.target.value))}
                                className="p-2 border rounded-lg bg-slate-50 font-bold text-slate-700"
                            >
                                {foods.map(f => <option key={f.id} value={f.id}>{f.emoji} {getFoodName(f.id, lang)}</option>)}
                            </select>
                        </div>
                    </div>

                    <div className="flex flex-col lg:flex-row gap-8 items-start justify-center w-full max-w-6xl">

                        {/* GRAPH VISUALIZATION */}
                        <div className="relative w-full max-w-[400px] aspect-square bg-white rounded-xl shadow-lg border-2 border-slate-200 grid-bg overflow-hidden no-select mx-auto flex-shrink-0">
                             {/* Axes Labels */}
                             <div className="absolute top-2 left-1/2 -translate-x-1/2 font-bold text-[10px] text-indigo-600 bg-white/80 px-2 rounded pointer-events-none z-10">{t.axes.crunchy} (+1)</div>
                            <div className="absolute bottom-2 left-1/2 -translate-x-1/2 font-bold text-[10px] text-orange-600 bg-white/80 px-2 rounded pointer-events-none z-10">{t.axes.soft} (-1)</div>
                            <div className="absolute left-1 top-1/2 -translate-y-1/2 -rotate-90 font-bold text-[10px] text-amber-700 bg-white/80 px-2 rounded origin-center pointer-events-none z-10">{t.axes.savory} (-1)</div>
                            <div className="absolute right-1 top-1/2 -translate-y-1/2 rotate-90 font-bold text-[10px] text-pink-600 bg-white/80 px-2 rounded origin-center pointer-events-none z-10">{t.axes.sweet} (+1)</div>

                            {/* SVG Layer for Vectors and Arc */}
                            <svg className="absolute inset-0 w-full h-full pointer-events-none z-0" viewBox="-1.2 -1.2 2.4 2.4">
                                <line x1="-1.2" y1="0" x2="1.2" y2="0" stroke="#94a3b8" strokeWidth="0.01" />
                                <line x1="0" y1="-1.2" x2="0" y2="1.2" stroke="#94a3b8" strokeWidth="0.01" />

                                {/* Angle Arc */}
                                <path d={arcPath} fill="none" stroke="#8b5cf6" strokeWidth="0.02" strokeDasharray="0.05 0.05" />
                                <text x={startX*1.5} y={startY*1.5} fontSize="0.15" fill="#8b5cf6" textAnchor="middle">{angleDeg.toFixed(0)}¬∞</text>

                                {/* Vectors */}
                                <line x1="0" y1="0" x2={item1.x} y2={-item1.y} stroke="#3b82f6" strokeWidth="0.03" markerEnd="url(#arrow-blue)" />
                                <line x1="0" y1="0" x2={item2.x} y2={-item2.y} stroke="#ef4444" strokeWidth="0.03" markerEnd="url(#arrow-red)" />

                                <defs>
                                    <marker id="arrow-blue" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                                        <path d="M0,0 L6,3 L0,6" fill="#3b82f6" />
                                    </marker>
                                    <marker id="arrow-red" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                                        <path d="M0,0 L6,3 L0,6" fill="#ef4444" />
                                    </marker>
                                </defs>
                            </svg>

                            {/* Food Items (HTML Overlay) */}
                            {foods.map(food => {
                                const isSelected = food.id === item1Id || food.id === item2Id;
                                return (
                                    <div 
                                        key={food.id}
                                        className={`absolute w-8 h-8 -ml-4 -mt-4 flex items-center justify-center transition-all duration-300
                                            ${isSelected ? 'opacity-100 z-20 scale-125' : 'opacity-30 grayscale z-10'}
                                        `}
                                        style={{ left: `${(food.x + 1) * 50}%`, top: `${(1 - food.y) * 50}%` }}
                                    >
                                        <div className="text-xl">
                                            <FoodVisual food={food} />
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {/* MATH & FORMULA PANEL */}
                        <div className="w-full max-w-xl bg-slate-50 rounded-xl p-6 border border-slate-200 shadow-inner flex flex-col justify-center">
                            <h3 className="font-bold text-lg text-slate-800 mb-4 border-b pb-2">{t.calcTitle}</h3>
                            
                            {/* Simplified Formula */}
                            <div className="bg-white p-6 rounded-lg border border-slate-200 mb-6 text-center">
                                <p className="text-slate-500 text-sm uppercase tracking-wider mb-2 font-bold">{t.formulaLabel}</p>
                                <p className="font-serif text-2xl italic mb-2">
                                    Similarity = 
                                    <span className="inline-flex flex-col align-middle mx-2">
                                        <span className="border-b border-black px-1">A ¬∑ B</span>
                                        <span className="px-1">||A|| √ó ||B||</span>
                                    </span>
                                </p>
                            </div>

                            {/* Final Result Display */}
                            <div className="bg-slate-800 text-white p-6 rounded-xl shadow-lg transform transition-all hover:scale-105">
                                <div className="text-center">
                                    <p className="text-indigo-300 text-sm font-mono mb-2">
                                        Similarity({getFoodName(item1.id, lang)}, {getFoodName(item2.id, lang)}) = 
                                    </p>
                                    <div className={`text-5xl font-bold font-mono ${getSimilarityColor(similarity)}`}>
                                        {similarity.toFixed(3)}
                                    </div>
                                    <p className="mt-4 text-sm text-slate-400 border-t border-slate-600 pt-3">
                                        {t.angleLabel}: <span className="text-white font-bold">{angleDeg.toFixed(1)}¬∞</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button 
                        onClick={onNext}
                        className="mt-8 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all"
                    >
                        {t.next} ‚Üí
                    </button>
                </div>
            );
        };


        // --- Component: Step 5 (Conclusion) ---
        const StepConclusion = ({t, onRestart}) => (
            <div className="flex flex-col items-center justify-center min-h-[calc(100vh-80px)] p-6 text-center fade-in pb-20">
                <div className="bg-white p-8 rounded-2xl shadow-xl max-w-2xl w-full">
                    <div className="text-6xl mb-4">üéâ</div>
                    <h2 className="text-3xl font-bold text-slate-800 mb-4">{t.conclusionTitle}</h2>
                    
                    <div className="text-left bg-slate-50 p-6 rounded-lg mb-8 space-y-3">
                        <p className="flex items-start gap-2">
                            <span className="text-green-500 font-bold">‚úì</span>
                            <span>{t.c1}</span>
                        </p>
                        <p className="flex items-start gap-2">
                            <span className="text-green-500 font-bold">‚úì</span>
                            <span>{t.c2}</span>
                        </p>
                        <p className="flex items-start gap-2">
                            <span className="text-green-500 font-bold">‚úì</span>
                            <span>{t.c3}</span>
                        </p>
                    </div>

                    <button 
                        onClick={onRestart}
                        className="mt-6 text-slate-400 hover:text-slate-600 underline text-sm"
                    >
                        {t.restart}
                    </button>
                </div>
            </div>
        );

        // --- Main App Component ---
        const App = () => {
            const [step, setStep] = useState(1);
            const [lang, setLang] = useState('en');
            const [foods, setFoods] = useState(INITIAL_FOODS);

            // Scramble positions slightly on mount for Step 2 engagement
            useEffect(() => {
                setFoods(prev => prev.map(f => ({
                    ...f,
                    x: (Math.random() - 0.5) * 0.5, // Start near center
                    y: (Math.random() - 0.5) * 0.5 
                })));
            }, []);

            const nextStep = () => setStep(s => s + 1);
            const prevStep = () => setStep(s => Math.max(1, s - 1));

            return (
                <div className="min-h-screen flex flex-col">
                    <Header 
                        step={step} 
                        lang={lang} 
                        setLang={setLang} 
                        t={TRANSLATIONS[lang]} 
                        onBack={prevStep}
                    />
                    
                    <main className="flex-grow relative">
                        {step === 1 && <StepIntro onNext={nextStep} t={TRANSLATIONS[lang]} />}
                        {step === 2 && <StepGrid foods={foods} setFoods={setFoods} onNext={nextStep} t={TRANSLATIONS[lang]} lang={lang} />}
                        {step === 3 && <StepMatrix foods={foods} onNext={nextStep} t={TRANSLATIONS[lang]} lang={lang} />}
                        {step === 4 && <StepSimilarity foods={foods} onNext={nextStep} t={TRANSLATIONS[lang]} lang={lang} />}
                        {step === 5 && <StepConclusion t={TRANSLATIONS[lang]} onRestart={() => setStep(1)} />}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>